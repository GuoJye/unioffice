# è®¸å¯è¯ç”Ÿæˆå™¨æ–‡ä»¶ä¾èµ–è¯´æ˜

## ğŸ“‹ æ ¸å¿ƒé—®é¢˜è§£ç­”

### âœ… åªéœ€è¦ä¸€ä¸ªæ–‡ä»¶å—ï¼Ÿ

**ä¸æ˜¯ï¼** ä½†éå¸¸ç®€å•ï¼Œåªéœ€è¦ **2ä¸ªæ–‡ä»¶**ï¼š

1. âœ… `license_gen.go` - ç”Ÿæˆå™¨ç¨‹åºï¼ˆå¿…éœ€ï¼‰
2. âœ… `new_private.pem` - RSAç§é’¥æ–‡ä»¶ï¼ˆå¿…éœ€ï¼‰

**ä¸éœ€è¦** å…¶ä»–ä»»ä½• `.txt` æ–‡ä»¶ï¼

---

## ğŸ“ æ–‡ä»¶ä¾èµ–è¯¦è§£

### å¿…éœ€æ–‡ä»¶ï¼ˆ2ä¸ªï¼‰

```
license_gen.go          # ç”Ÿæˆå™¨ç¨‹åºä»£ç 
new_private.pem         # RSAç§é’¥ï¼ˆç”¨äºç­¾åè®¸å¯è¯ï¼‰
```

### å¯é€‰æ–‡ä»¶

```
new_public_pem.pem      # RSAå…¬é’¥ï¼ˆä»…é¦–æ¬¡ç”Ÿæˆå¯†é’¥æ—¶éœ€è¦ï¼‰
```


---

## ğŸš€ ä½¿ç”¨åœºæ™¯

### åœºæ™¯ 1: æˆ‘å·²ç»æœ‰å¯†é’¥ï¼Œåªæƒ³ç”Ÿæˆè®¸å¯è¯

**éœ€è¦çš„æ–‡ä»¶**ï¼š
```
license_gen.go          âœ… å¿…éœ€
new_private.pem         âœ… å¿…éœ€
```

**å‘½ä»¤**ï¼š
```bash
go run license_gen.go \
  -customer "æ‚¨çš„å®¢æˆ·å" \
  -output license.key \
  -privkey new_private.pem
```

**æ˜¯å¦éœ€è¦åœ¨åŒä¸€ç›®å½•ï¼Ÿ**
- `license_gen.go` å¯ä»¥åœ¨ä»»ä½•ä½ç½®è¿è¡Œ
- `new_private.pem` å¯ä»¥åœ¨ä»»ä½•ä½ç½®ï¼Œé€šè¿‡ `-privkey` å‚æ•°æŒ‡å®šè·¯å¾„

**ç¤ºä¾‹ï¼ˆæ–‡ä»¶åœ¨ä¸åŒä½ç½®ï¼‰**ï¼š
```bash
# license_gen.go åœ¨å½“å‰ç›®å½•
# new_private.pem åœ¨ /home/user/keys/ ç›®å½•
go run license_gen.go \
  -customer "ABC Corp" \
  -output license.key \
  -privkey /home/user/keys/new_private.pem
```

---

### åœºæ™¯ 2: é¦–æ¬¡ä½¿ç”¨ï¼Œéœ€è¦ç”Ÿæˆå¯†é’¥

**ç¬¬ä¸€æ­¥ï¼šç”Ÿæˆå¯†é’¥å¯¹**
```bash
go run license_gen.go \
  -genkeys \
  -privkey my_private.pem \
  -pubkey my_public.pem
```

è¿™ä¼šç”Ÿæˆï¼š
- `my_private.pem` - ç§é’¥ï¼ˆç”¨äºç­¾åï¼‰
- `my_public.pem` - å…¬é’¥ï¼ˆéœ€è¦æ”¾å…¥æºä»£ç ï¼‰

**ç¬¬äºŒæ­¥ï¼šæ›¿æ¢æºä»£ç ä¸­çš„å…¬é’¥**
ç¨‹åºä¼šè¾“å‡ºå…¬é’¥çš„åå…­è¿›åˆ¶æ ¼å¼ï¼Œéœ€è¦æ›¿æ¢åˆ°æºä»£ç ä¸­ï¼ˆè¿™ä¸€æ­¥å·²ç»å®Œæˆï¼‰ã€‚

**ç¬¬ä¸‰æ­¥ï¼šç”Ÿæˆè®¸å¯è¯**
```bash
go run license_gen.go \
  -customer "å®¢æˆ·å" \
  -output license.key \
  -privkey my_private.pem
```

---

## ğŸ“¦ æœ€å°éƒ¨ç½²åŒ…

å¦‚æœè¦æŠŠç”Ÿæˆå™¨ç»™åˆ«äººä½¿ç”¨ï¼Œåªéœ€è¦æä¾›ï¼š

```
ğŸ“¦ è®¸å¯è¯ç”Ÿæˆå™¨éƒ¨ç½²åŒ…
â”œâ”€â”€ license_gen.go      # ç”Ÿæˆå™¨æºä»£ç 
â””â”€â”€ new_private.pem     # ç§é’¥æ–‡ä»¶
```

æ¥æ”¶è€…åªéœ€è¦ï¼š
1. å®‰è£… Go ç¯å¢ƒ
2. è¿è¡Œå‘½ä»¤ç”Ÿæˆè®¸å¯è¯

---

## ğŸ’¡ å®Œæ•´ç¤ºä¾‹

### ç¤ºä¾‹ 1: æ–‡ä»¶åœ¨åŒä¸€ç›®å½•

```bash
# ç›®å½•ç»“æ„
.
â”œâ”€â”€ license_gen.go
â””â”€â”€ new_private.pem

# ç”Ÿæˆè®¸å¯è¯
go run license_gen.go -customer "TestUser" -output license.key
```

### ç¤ºä¾‹ 2: æ–‡ä»¶åœ¨ä¸åŒç›®å½•

```bash
# ç›®å½•ç»“æ„
/project/
  â”œâ”€â”€ tools/
  â”‚   â””â”€â”€ license_gen.go
  â””â”€â”€ keys/
      â””â”€â”€ new_private.pem

# åœ¨ /project/tools/ ç›®å½•æ‰§è¡Œ
cd /project/tools/
go run license_gen.go \
  -customer "TestUser" \
  -output license.key \
  -privkey ../keys/new_private.pem

# è®¸å¯è¯ä¼šç”Ÿæˆåœ¨å½“å‰ç›®å½•ï¼š/project/tools/license.key
```

### ç¤ºä¾‹ 3: æŒ‡å®šè¾“å‡ºç›®å½•

```bash
go run license_gen.go \
  -customer "TestUser" \
  -output /home/user/licenses/customer1.key \
  -privkey /secure/keys/new_private.pem
```

---

## ğŸ” å‚æ•°è¯´æ˜

```bash
go run license_gen.go [å‚æ•°]
```

| å‚æ•° | è¯´æ˜ | å¿…å¡« | é»˜è®¤å€¼ |
|------|------|------|--------|
| `-customer` | å®¢æˆ·åç§° | âœ… æ˜¯ | `TestCustomer` |
| `-output` | è¾“å‡ºè®¸å¯è¯æ–‡ä»¶è·¯å¾„ | âŒ å¦ | `license.key` |
| `-privkey` | ç§é’¥æ–‡ä»¶è·¯å¾„ | âŒ å¦ | `private.pem` |
| `-debug` | æ˜¾ç¤ºè°ƒè¯•ä¿¡æ¯ | âŒ å¦ | `false` |
| `-genkeys` | ç”Ÿæˆæ–°å¯†é’¥å¯¹ | âŒ å¦ | `false` |
| `-pubkey` | å…¬é’¥è¾“å‡ºè·¯å¾„ï¼ˆç”Ÿæˆå¯†é’¥æ—¶ï¼‰ | âŒ å¦ | `public.pem` |

---

## âš ï¸ å¸¸è§è¯¯åŒº

### âŒ è¯¯åŒº 1: éœ€è¦æ‰€æœ‰ .txt æ–‡ä»¶
**é”™è¯¯**ï¼šä»¥ä¸ºéœ€è¦ `public_key_hex.txt` ç­‰æ–‡ä»¶  
**æ­£ç¡®**ï¼šåªéœ€è¦ `license_gen.go` å’Œ `new_private.pem`

### âŒ è¯¯åŒº 2: æ–‡ä»¶å¿…é¡»åœ¨åŒä¸€ç›®å½•
**é”™è¯¯**ï¼šæŠŠæ‰€æœ‰æ–‡ä»¶æ”¾åœ¨åŒä¸€ä¸ªç›®å½•  
**æ­£ç¡®**ï¼šå¯ä»¥é€šè¿‡å‚æ•°æŒ‡å®šä»»æ„è·¯å¾„

### âŒ è¯¯åŒº 3: éœ€è¦å…¬é’¥æ–‡ä»¶
**é”™è¯¯**ï¼šè¿è¡Œæ—¶éœ€è¦ `new_public_pem.pem`  
**æ­£ç¡®**ï¼šç”Ÿæˆè®¸å¯è¯æ—¶åªéœ€è¦ç§é’¥ï¼Œå…¬é’¥å·²ç»åœ¨æºä»£ç ä¸­

---

## ğŸ“‚ æ¨èçš„ç›®å½•ç»“æ„

### å¼€å‘ç¯å¢ƒ
```
/workspaces/unioffice/
â”œâ”€â”€ test/
â”‚   â”œâ”€â”€ license_gen.go       # ç”Ÿæˆå™¨
â”‚   â”œâ”€â”€ new_private.pem       # ç§é’¥ï¼ˆâš ï¸ä¿å¯†ï¼‰
â”‚   â”œâ”€â”€ new_public_pem.pem    # å…¬é’¥ï¼ˆå¤‡ä»½ï¼‰
â”‚   â”œâ”€â”€ test_license.go       # æµ‹è¯•ç¨‹åº
â”‚   â””â”€â”€ *.md                  # æ–‡æ¡£
â””â”€â”€ internal/license/
    â””â”€â”€ license.go            # åŒ…å«å…¬é’¥çš„æºä»£ç 
```

### ç”Ÿäº§ç¯å¢ƒï¼ˆè®¸å¯è¯ç”ŸæˆæœåŠ¡å™¨ï¼‰
```
/opt/license-generator/
â”œâ”€â”€ license_gen.go            # ç”Ÿæˆå™¨
â”œâ”€â”€ keys/
â”‚   â”œâ”€â”€ private.pem           # ç§é’¥ï¼ˆä¸¥æ ¼ä¿æŠ¤ï¼‰
â”‚   â””â”€â”€ private.pem.backup    # å¤‡ä»½
â””â”€â”€ output/
    â””â”€â”€ *.key                 # ç”Ÿæˆçš„è®¸å¯è¯
```

---

## ğŸ”’ å®‰å…¨å»ºè®®

### ç§é’¥æ–‡ä»¶å®‰å…¨

1. **æƒé™è®¾ç½®**
   ```bash
   chmod 600 new_private.pem  # åªæœ‰æ‰€æœ‰è€…å¯è¯»å†™
   ```

2. **ä¸è¦æäº¤åˆ°ä»£ç ä»“åº“**
   ```bash
   # .gitignore
   *.pem
   new_private.pem
   private.pem
   ```

3. **å¤‡ä»½åˆ°å®‰å…¨ä½ç½®**
   ```bash
   # åŠ å¯†å¤‡ä»½
   gpg -c new_private.pem
   # ç”Ÿæˆ new_private.pem.gpg
   ```

4. **é™åˆ¶è®¿é—®**
   - åªæœ‰æˆæƒäººå‘˜å¯ä»¥è®¿é—®
   - ä½¿ç”¨ä¸“é—¨çš„å¯†é’¥ç®¡ç†ç³»ç»Ÿ
   - å®šæœŸè½®æ¢å¯†é’¥

---

## ğŸ¯ å¿«é€Ÿæ£€æŸ¥æ¸…å•

ç”Ÿæˆè®¸å¯è¯å‰ï¼Œæ£€æŸ¥ï¼š

- [ ] `license_gen.go` æ–‡ä»¶å­˜åœ¨ä¸”å¯è¯»
- [ ] `new_private.pem` æ–‡ä»¶å­˜åœ¨ä¸”å¯è¯»
- [ ] Go ç¯å¢ƒå·²å®‰è£… (`go version`)
- [ ] å†³å®šå¥½å®¢æˆ·åç§°
- [ ] å†³å®šå¥½è¾“å‡ºæ–‡ä»¶è·¯å¾„

å…¨éƒ¨æ‰“å‹¾åï¼Œè¿è¡Œï¼š
```bash
go run license_gen.go -customer "å®¢æˆ·å" -output license.key -privkey new_private.pem
```

---

## â“ å¸¸è§é—®é¢˜

### Q1: å¯ä»¥æŠŠ license_gen.go ç¼–è¯‘æˆå¯æ‰§è¡Œæ–‡ä»¶å—ï¼Ÿ

**A**: å¯ä»¥ï¼è¿™æ ·æ›´æ–¹ä¾¿åˆ†å‘ï¼š

```bash
# ç¼–è¯‘
go build -o license-gen license_gen.go

# ä½¿ç”¨
./license-gen -customer "å®¢æˆ·å" -output license.key -privkey new_private.pem
```

ç¼–è¯‘ååªéœ€è¦åˆ†å‘ï¼š
- `license-gen` (å¯æ‰§è¡Œæ–‡ä»¶)
- `new_private.pem` (ç§é’¥)

### Q2: ç§é’¥æ–‡ä»¶ä¸¢å¤±äº†æ€ä¹ˆåŠï¼Ÿ

**A**: 
- å·²ç”Ÿæˆçš„è®¸å¯è¯ä»ç„¶å¯ç”¨
- ä½†æ— æ³•ç”Ÿæˆæ–°è®¸å¯è¯
- éœ€è¦é‡æ–°ç”Ÿæˆå¯†é’¥å¯¹å¹¶ä¿®æ”¹æºä»£ç 
- **åŠ¡å¿…åšå¥½å¤‡ä»½ï¼**

### Q3: å¯ä»¥åœ¨ Windows/Mac/Linux ä¸Šä½¿ç”¨å—ï¼Ÿ

**A**: å¯ä»¥ï¼`license_gen.go` æ˜¯è·¨å¹³å°çš„ï¼š

**Windows**:
```cmd
go run license_gen.go -customer "å®¢æˆ·å" -output license.key -privkey new_private.pem
```

**Mac/Linux**:
```bash
go run license_gen.go -customer "å®¢æˆ·å" -output license.key -privkey new_private.pem
```

### Q4: èƒ½å¦é€šè¿‡ç½‘ç»œè®¿é—®ç§é’¥ï¼Ÿ

**A**: å¯ä»¥ï¼Œä½†ä¸æ¨èã€‚å¦‚æœå¿…é¡»ï¼š

```bash
# ä» S3 ä¸‹è½½ç§é’¥ï¼ˆç¤ºä¾‹ï¼‰
aws s3 cp s3://secure-bucket/private.pem /tmp/private.pem
chmod 600 /tmp/private.pem

# ä½¿ç”¨
go run license_gen.go -privkey /tmp/private.pem -customer "å®¢æˆ·å"

# ä½¿ç”¨åç«‹å³åˆ é™¤
rm /tmp/private.pem
```

---

## ğŸ“Š æ€»ç»“

| ç»„ä»¶ | æ˜¯å¦å¿…éœ€ | ä½ç½®è¦æ±‚ | è¯´æ˜ |
|------|---------|---------|------|
| `license_gen.go` | âœ… å¿…éœ€ | ä»»æ„ä½ç½® | ç”Ÿæˆå™¨ç¨‹åº |
| `new_private.pem` | âœ… å¿…éœ€ | ä»»æ„ä½ç½®ï¼ˆé€šè¿‡å‚æ•°æŒ‡å®šï¼‰ | ç­¾åå¯†é’¥ |
| `new_public_pem.pem` | âŒ ä¸éœ€è¦ | - | ä»…é¦–æ¬¡ç”Ÿæˆå¯†é’¥æ—¶ |
| `.txt` æ–‡ä»¶ | âŒ ä¸éœ€è¦ | - | å·²è¿‡æ—¶ |
| åŒä¸€ç›®å½• | âŒ ä¸è¦æ±‚ | - | å¯é€šè¿‡å‚æ•°æŒ‡å®šè·¯å¾„ |

**æ ¸å¿ƒè¦ç‚¹**ï¼š
- ğŸ¯ åªéœ€è¦ 2 ä¸ªæ–‡ä»¶
- ğŸ“‚ æ–‡ä»¶å¯ä»¥åœ¨ä¸åŒä½ç½®
- ğŸ” ä¿æŠ¤å¥½ç§é’¥æ–‡ä»¶
- âœ… æ‰€æœ‰è·¯å¾„éƒ½å¯ä»¥è‡ªå®šä¹‰

---

**æœ€åæ›´æ–°**: 2025-12-14  
**ç‰ˆæœ¬**: 1.0  
**çŠ¶æ€**: âœ… å·²éªŒè¯
