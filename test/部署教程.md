# ðŸš€ è®¸å¯è¯ç³»ç»Ÿå®Œæ•´éƒ¨ç½²æ•™ç¨‹

## âš ï¸ æ ¸å¿ƒé—®é¢˜è§£å†³

### æ‚¨é‡åˆ°çš„é”™è¯¯åŽŸå› 

```
âŒ è®¸å¯è¯éªŒè¯å¤±è´¥: crypto/rsa: verification error
```

**æ ¹æœ¬åŽŸå› **ï¼šå¯†é’¥å¯¹ä¸åŒ¹é…ï¼

- âœ… **æ­£ç¡®**ï¼šæºä»£ç ä¸­çš„å…¬é’¥ = `new_public_pem.pem`
- âŒ **é”™è¯¯**ï¼šæ‚¨ä½¿ç”¨ `my_private.pem` ç”Ÿæˆè®¸å¯è¯
- ðŸ’¥ **ç»“æžœ**ï¼šç­¾åéªŒè¯å¤±è´¥ï¼

### å¯†é’¥å¯¹åº”å…³ç³»ï¼ˆå¿…é¡»ä¸¥æ ¼åŒ¹é…ï¼‰

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   å¼€å‘çŽ¯å¢ƒ (ä¿®æ”¹æºä»£ç çš„æœºå™¨)       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                     â”‚
â”‚  1ï¸âƒ£ new_private.pem  â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚     (ç­¾åå¯†é’¥)              â”‚       â”‚
â”‚                             â”œâ”€â”€é…å¯¹â”€â”¤
â”‚  2ï¸âƒ£ new_public_pem.pem â”€â”€â”€â”€â”˜      â”‚
â”‚     (éªŒè¯å¯†é’¥)                      â”‚
â”‚                                     â”‚
â”‚  3ï¸âƒ£ æ›¿æ¢æºä»£ç :                    â”‚
â”‚     internal/license/license.go   â”‚
â”‚     const _dba = "new_public..."  â”‚
â”‚                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â”‚ å¤åˆ¶åˆ°å…¶ä»–æœºå™¨
           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   ç”Ÿäº§çŽ¯å¢ƒ (å…¶ä»–æœºå™¨)               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                     â”‚
â”‚  âœ… æºä»£ç  (åŒ…å«new_public.pem)    â”‚
â”‚     â”œâ”€â”€ internal/license/          â”‚
â”‚     â”‚   â””â”€â”€ license.go             â”‚
â”‚     â”‚       const _dba = "..."     â”‚
â”‚     â””â”€â”€ ... å…¶ä»–ä»£ç  ...            â”‚
â”‚                                     â”‚
â”‚  âœ… new_private.pem                â”‚
â”‚     (ç”¨äºŽç”Ÿæˆè®¸å¯è¯)                â”‚
â”‚                                     â”‚
â”‚  âœ… license_gen.go                 â”‚
â”‚     (ç”Ÿæˆå™¨ç¨‹åº)                    â”‚
â”‚                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ðŸ“‹ å®Œæ•´éƒ¨ç½²æµç¨‹

### ç¬¬ 1 æ­¥ï¼šç¡®è®¤å¯†é’¥å¯¹

**åœ¨å¼€å‘æœºå™¨ä¸Š**ï¼š

```bash
cd /workspaces/unioffice/test

# æ£€æŸ¥å¿…éœ€çš„å¯†é’¥æ–‡ä»¶
ls -la new_private.pem new_public_pem.pem
```

**é¢„æœŸè¾“å‡º**ï¼š
```
-rw-rw-rw- 1 user user 1674 Dec 14 05:42 new_private.pem
-rw-rw-rw- 1 user user  450 Dec 14 05:46 new_public_pem.pem
```

### ç¬¬ 2 æ­¥ï¼šéªŒè¯æºä»£ç ä¸­çš„å…¬é’¥

**æ£€æŸ¥æºä»£ç **ï¼š

```bash
cd /workspaces/unioffice

# æŸ¥çœ‹æºä»£ç ä¸­çš„å…¬é’¥ï¼ˆconst _dbaï¼‰
grep -A 1 "const _dba" internal/license/license.go
```

**é¢„æœŸè¾“å‡º**ï¼šåº”è¯¥çœ‹åˆ° Unicode è½¬ä¹‰çš„ PEM æ ¼å¼å…¬é’¥ã€‚

**éªŒè¯å…¬é’¥å†…å®¹**ï¼š

```bash
# ç”Ÿæˆå…¬é’¥çš„åå…­è¿›åˆ¶æ ¼å¼
cd test
go run license_gen.go -genkeys -privkey test_priv.pem -pubkey test_pub.pem 2>&1 | grep "const _dba"
```

### ç¬¬ 3 æ­¥ï¼šå‡†å¤‡éƒ¨ç½²åŒ…

**æ–¹æ¡ˆ Aï¼šæœ€å°éƒ¨ç½²åŒ…ï¼ˆæŽ¨èï¼‰**

```bash
# åœ¨å¼€å‘æœºå™¨ä¸Šåˆ›å»ºéƒ¨ç½²åŒ…
cd /workspaces/unioffice
mkdir -p /tmp/license-deployment

# 1. å¤åˆ¶æ•´ä¸ªæºä»£ç ä»“åº“ï¼ˆåŒ…å«ä¿®æ”¹åŽçš„å…¬é’¥ï¼‰
cp -r /workspaces/unioffice /tmp/license-deployment/unioffice

# 2. å¤åˆ¶ç§é’¥åˆ°å®‰å…¨ä½ç½®
cp test/new_private.pem /tmp/license-deployment/private_key.pem
chmod 600 /tmp/license-deployment/private_key.pem

# 3. å¤åˆ¶ç”Ÿæˆå™¨
cp test/license_gen.go /tmp/license-deployment/

# 4. åˆ›å»ºè¯´æ˜Žæ–‡ä»¶
cat > /tmp/license-deployment/README.txt << 'EOF'
è®¸å¯è¯éƒ¨ç½²åŒ…
=============

æ–‡ä»¶æ¸…å•ï¼š
- unioffice/          å®Œæ•´æºä»£ç ï¼ˆåŒ…å«ä¿®æ”¹åŽçš„å…¬é’¥ï¼‰
- license_gen.go      è®¸å¯è¯ç”Ÿæˆå™¨
- private_key.pem     ç§é’¥ï¼ˆâš ï¸ä¿å¯†ï¼ï¼‰
- README.txt          æœ¬æ–‡ä»¶

ä½¿ç”¨æ–¹æ³•ï¼š
1. éƒ¨ç½²æºä»£ç åˆ°ç›®æ ‡æœºå™¨
2. ä½¿ç”¨ license_gen.go ç”Ÿæˆè®¸å¯è¯
3. åœ¨ç›®æ ‡æœºå™¨ä¸Šä½¿ç”¨ç”Ÿæˆçš„è®¸å¯è¯
EOF

# 5. æ‰“åŒ…
cd /tmp
tar czf license-deployment.tar.gz license-deployment/

echo "âœ… éƒ¨ç½²åŒ…å·²åˆ›å»º: /tmp/license-deployment.tar.gz"
ls -lh /tmp/license-deployment.tar.gz
```

**æ–¹æ¡ˆ Bï¼šå·²ç¼–è¯‘äºŒè¿›åˆ¶éƒ¨ç½²ï¼ˆæ›´å®‰å…¨ï¼‰**

```bash
# ç¼–è¯‘ç”Ÿæˆå™¨ä¸ºç‹¬ç«‹å¯æ‰§è¡Œæ–‡ä»¶
cd /workspaces/unioffice/test
go build -o license-generator license_gen.go

# åˆ›å»ºéƒ¨ç½²åŒ…
mkdir -p /tmp/license-binary-deployment
cp license-generator /tmp/license-binary-deployment/
cp new_private.pem /tmp/license-binary-deployment/private_key.pem
chmod 600 /tmp/license-binary-deployment/private_key.pem
chmod +x /tmp/license-binary-deployment/license-generator

# æ‰“åŒ…æºä»£ç 
cd /workspaces/unioffice
tar czf /tmp/license-binary-deployment/unioffice-source.tar.gz \
  --exclude='.git' \
  --exclude='test' \
  --exclude='*.md' \
  .

cd /tmp
tar czf license-binary-deployment.tar.gz license-binary-deployment/

echo "âœ… äºŒè¿›åˆ¶éƒ¨ç½²åŒ…å·²åˆ›å»º: /tmp/license-binary-deployment.tar.gz"
```

---

## ðŸ–¥ï¸ ç›®æ ‡æœºå™¨éƒ¨ç½²

### ç¬¬ 4 æ­¥ï¼šåœ¨ç›®æ ‡æœºå™¨ä¸Šéƒ¨ç½²

**4.1 ä¼ è¾“éƒ¨ç½²åŒ…**

```bash
# æ–¹å¼ 1: scp
scp /tmp/license-deployment.tar.gz user@target-machine:/tmp/

# æ–¹å¼ 2: USB æ‹·è´
# å°† license-deployment.tar.gz å¤åˆ¶åˆ° USB

# æ–¹å¼ 3: äº‘å­˜å‚¨ï¼ˆä¸æŽ¨èï¼Œç§é’¥æ•æ„Ÿï¼‰
# ä¸Šä¼ åˆ°åŠ å¯†çš„ç§æœ‰å­˜å‚¨
```

**4.2 åœ¨ç›®æ ‡æœºå™¨ä¸Šè§£åŽ‹**

```bash
# SSH ç™»å½•åˆ°ç›®æ ‡æœºå™¨
ssh user@target-machine

# è§£åŽ‹éƒ¨ç½²åŒ…
cd /opt  # æˆ–ä»»æ„å®‰å…¨ä½ç½®
sudo tar xzf /tmp/license-deployment.tar.gz
cd license-deployment

# æ£€æŸ¥æ–‡ä»¶
ls -la
```

**é¢„æœŸæ–‡ä»¶ç»“æž„**ï¼š
```
/opt/license-deployment/
â”œâ”€â”€ unioffice/              # æºä»£ç ï¼ˆåŒ…å«æ–°å…¬é’¥ï¼‰
â”‚   â”œâ”€â”€ internal/license/
â”‚   â”‚   â””â”€â”€ license.go      # âš ï¸ const _dba å·²æ›¿æ¢
â”‚   â”œâ”€â”€ document/
â”‚   â”œâ”€â”€ spreadsheet/
â”‚   â””â”€â”€ ... å…¶ä»–ä»£ç 
â”œâ”€â”€ license_gen.go          # ç”Ÿæˆå™¨
â”œâ”€â”€ private_key.pem         # ç§é’¥ âš ï¸ä¿å¯†
â””â”€â”€ README.txt              # è¯´æ˜Ž
```

### ç¬¬ 5 æ­¥ï¼šé…ç½®çŽ¯å¢ƒ

**5.1 å®‰è£… Goï¼ˆå¦‚æžœæ²¡æœ‰ï¼‰**

```bash
# Ubuntu/Debian
sudo apt update
sudo apt install golang-go

# CentOS/RHEL
sudo yum install golang

# macOS
brew install go

# éªŒè¯å®‰è£…
go version  # åº”è¯¥æ˜¾ç¤º 1.21 æˆ–æ›´é«˜
```

**5.2 è®¾ç½® Go æ¨¡å—**

```bash
cd /opt/license-deployment/unioffice

# åˆå§‹åŒ–æ¨¡å—ï¼ˆå¦‚æžœ go.mod å·²å­˜åœ¨åˆ™è·³è¿‡ï¼‰
# go mod init github.com/unidoc/unioffice/v2

# ä¸‹è½½ä¾èµ–
go mod download

# éªŒè¯ç¼–è¯‘
go build ./...
```

### ç¬¬ 6 æ­¥ï¼šç”Ÿæˆè®¸å¯è¯

**6.1 ä½¿ç”¨æ­£ç¡®çš„å¯†é’¥**

```bash
cd /opt/license-deployment

# âœ… æ­£ç¡®æ–¹å¼ï¼šä½¿ç”¨ new_private.pem
go run license_gen.go \
  -customer "å®¢æˆ·å…¬å¸å" \
  -output customer_license.key \
  -privkey private_key.pem

# âŒ é”™è¯¯æ–¹å¼ï¼šä¸è¦ç”¨å…¶ä»–å¯†é’¥ï¼
# go run license_gen.go -privkey my_private.pem  # è¿™ä¼šå¤±è´¥ï¼
```

**6.2 éªŒè¯ç”Ÿæˆçš„è®¸å¯è¯**

```bash
# ä½¿ç”¨éªŒè¯å·¥å…·æµ‹è¯•
cat > verify_test.go << 'EOF'
package main

import (
	"fmt"
	"os"
	"github.com/unidoc/unioffice/v2/common/license"
)

func main() {
	data, _ := os.ReadFile("customer_license.key")
	err := license.SetLicenseKey(string(data), "å®¢æˆ·å…¬å¸å")
	if err != nil {
		fmt.Printf("âŒ éªŒè¯å¤±è´¥: %v\n", err)
		os.Exit(1)
	}
	fmt.Println("âœ… è®¸å¯è¯éªŒè¯æˆåŠŸ!")
}
EOF

# åˆ›å»º go.mod
cat > go.mod << 'EOF'
module verify-test

go 1.21

replace github.com/unidoc/unioffice/v2 => ./unioffice

require github.com/unidoc/unioffice/v2 v2.0.0
EOF

# è¿è¡ŒéªŒè¯
go run verify_test.go
```

**é¢„æœŸè¾“å‡º**ï¼š
```
âœ… è®¸å¯è¯éªŒè¯æˆåŠŸ!
```

---

## ðŸ” æ•…éšœæŽ’é™¤

### é—®é¢˜ 1: "crypto/rsa: verification error"

**åŽŸå› **ï¼šå¯†é’¥å¯¹ä¸åŒ¹é…

**è§£å†³æ–¹æ¡ˆ**ï¼š

```bash
# 1. æ£€æŸ¥æ‚¨ä½¿ç”¨çš„ç§é’¥æ–‡ä»¶
ls -la private_key.pem new_private.pem my_private.pem

# 2. ç¡®è®¤æºä»£ç ä¸­çš„å…¬é’¥
cd unioffice
grep -c "const _dba" internal/license/license.go  # åº”è¯¥è¾“å‡º 1

# 3. ä½¿ç”¨æ­£ç¡®çš„å¯†é’¥é‡æ–°ç”Ÿæˆ
go run ../license_gen.go \
  -customer "TestUser" \
  -output test.key \
  -privkey ../private_key.pem  # âš ï¸ å¿…é¡»ç”¨éƒ¨ç½²åŒ…ä¸­çš„è¿™ä¸ªæ–‡ä»¶

# 4. éªŒè¯
go run ../verify_test.go
```

### é—®é¢˜ 2: "customer name mismatch"

**åŽŸå› **ï¼šéªŒè¯æ—¶çš„å®¢æˆ·åä¸Žè®¸å¯è¯ä¸­çš„ä¸ä¸€è‡´

**è§£å†³æ–¹æ¡ˆ**ï¼š

```bash
# ç”Ÿæˆè®¸å¯è¯æ—¶çš„å®¢æˆ·å
-customer "ABC Company"

# éªŒè¯æ—¶å¿…é¡»ä½¿ç”¨ç›¸åŒçš„åå­—
license.SetLicenseKey(data, "ABC Company")  # âœ… ç›¸åŒ
license.SetLicenseKey(data, "ABC Corp")     # âŒ ä¸åŒï¼ŒéªŒè¯å¤±è´¥
```

### é—®é¢˜ 3: å…¶ä»–æœºå™¨ä½¿ç”¨çš„æ˜¯è¿œç¨‹ä»“åº“ä»£ç 

**åŽŸå› **ï¼š`go.mod` ä¸­æ²¡æœ‰ `replace` æŒ‡ä»¤

**è§£å†³æ–¹æ¡ˆ**ï¼š

```bash
# æ£€æŸ¥ go.mod
cd /opt/license-deployment/unioffice
cat go.mod

# å¦‚æžœæ²¡æœ‰ replace æŒ‡ä»¤ï¼Œæ·»åŠ ï¼š
cat >> go.mod << 'EOF'

replace github.com/unidoc/unioffice/v2 => ./
EOF

# æˆ–è€…ç¼–è¾‘ go.modï¼Œæ·»åŠ ï¼š
# replace github.com/unidoc/unioffice/v2 => ./

# æ¸…é™¤ç¼“å­˜
go clean -modcache

# é‡æ–°éªŒè¯
cd ..
go run verify_test.go
```

### é—®é¢˜ 4: æ— æ³•è¯»å–è®¸å¯è¯æ–‡ä»¶

**æ£€æŸ¥æ–‡ä»¶æƒé™**ï¼š

```bash
# æ£€æŸ¥è®¸å¯è¯æ–‡ä»¶
ls -la customer_license.key

# ç¡®ä¿å¯è¯»
chmod 644 customer_license.key

# æ£€æŸ¥è·¯å¾„
pwd
realpath customer_license.key
```

---

## ðŸ“¦ ä¸åŒéƒ¨ç½²åœºæ™¯

### åœºæ™¯ A: å¼€å‘æµ‹è¯•ï¼ˆå½“å‰æœºå™¨ï¼‰

**æ–‡ä»¶ä½ç½®**ï¼š
```
/workspaces/unioffice/
â”œâ”€â”€ internal/license/license.go  (å·²ä¿®æ”¹)
â””â”€â”€ test/
    â”œâ”€â”€ license_gen.go
    â”œâ”€â”€ new_private.pem          âš ï¸ ä½¿ç”¨è¿™ä¸ª
    â””â”€â”€ new_public_pem.pem
```

**ç”Ÿæˆå‘½ä»¤**ï¼š
```bash
cd /workspaces/unioffice/test
go run license_gen.go -customer "TestUser" -privkey new_private.pem
```

### åœºæ™¯ B: ç”Ÿäº§æœåŠ¡å™¨ï¼ˆLinuxï¼‰

**éƒ¨ç½²æ­¥éª¤**ï¼š
```bash
# 1. ä¼ è¾“æ–‡ä»¶
scp -r /workspaces/unioffice user@server:/opt/
scp /workspaces/unioffice/test/new_private.pem user@server:/opt/keys/
scp /workspaces/unioffice/test/license_gen.go user@server:/opt/tools/

# 2. SSH ç™»å½•
ssh user@server

# 3. ç¼–è¯‘ç”Ÿæˆå™¨
cd /opt/tools
go build -o license-gen license_gen.go

# 4. ç”Ÿæˆè®¸å¯è¯
./license-gen \
  -customer "Production User" \
  -output /opt/licenses/prod.key \
  -privkey /opt/keys/new_private.pem

# 5. åœ¨åº”ç”¨ä¸­ä½¿ç”¨
export UNIDOC_LICENSE_PATH=/opt/licenses/prod.key
export UNIDOC_LICENSE_CUSTOMER_NAME="Production User"
./your-app
```

### åœºæ™¯ C: å®¢æˆ·æœºå™¨ï¼ˆWindowsï¼‰

**éƒ¨ç½²åŒ…å‡†å¤‡**ï¼š
```bash
# åœ¨å¼€å‘æœºä¸Š
cd /workspaces/unioffice
mkdir -p /tmp/windows-deployment

# å¤åˆ¶æºä»£ç 
cp -r /workspaces/unioffice /tmp/windows-deployment/

# å¤åˆ¶å¯†é’¥å’Œå·¥å…·
cp test/new_private.pem /tmp/windows-deployment/private.pem
cp test/license_gen.go /tmp/windows-deployment/

# åˆ›å»ºæ‰¹å¤„ç†æ–‡ä»¶
cat > /tmp/windows-deployment/generate_license.bat << 'EOF'
@echo off
echo ç”Ÿæˆ UniOffice è®¸å¯è¯
echo.

set /p CUSTOMER_NAME=è¯·è¾“å…¥å®¢æˆ·åç§°: 
set /p OUTPUT_FILE=è¾“å‡ºæ–‡ä»¶å (é»˜è®¤: license.key): 

if "%OUTPUT_FILE%"=="" set OUTPUT_FILE=license.key

go run license_gen.go -customer "%CUSTOMER_NAME%" -output "%OUTPUT_FILE%" -privkey private.pem

if %ERRORLEVEL% EQU 0 (
    echo.
    echo âœ“ è®¸å¯è¯ç”ŸæˆæˆåŠŸ: %OUTPUT_FILE%
    echo.
    pause
) else (
    echo.
    echo âœ— ç”Ÿæˆå¤±è´¥ï¼Œè¯·æ£€æŸ¥é”™è¯¯ä¿¡æ¯
    echo.
    pause
)
EOF

# æ‰“åŒ…ä¸º ZIP
cd /tmp
zip -r windows-deployment.zip windows-deployment/
```

**åœ¨ Windows ä¸Šä½¿ç”¨**ï¼š
```cmd
REM 1. è§£åŽ‹ windows-deployment.zip

REM 2. åŒå‡» generate_license.bat

REM 3. è¾“å…¥å®¢æˆ·åç§°

REM 4. èŽ·å¾— license.key æ–‡ä»¶
```

### åœºæ™¯ D: Docker å®¹å™¨

**Dockerfile**ï¼š
```dockerfile
FROM golang:1.21-alpine

WORKDIR /app

# å¤åˆ¶æºä»£ç 
COPY unioffice/ /app/unioffice/

# å¤åˆ¶ç”Ÿæˆå™¨å’Œå¯†é’¥
COPY license_gen.go /app/
COPY private_key.pem /app/
RUN chmod 600 /app/private_key.pem

# ç¼–è¯‘ç”Ÿæˆå™¨
RUN go build -o /usr/local/bin/license-gen /app/license_gen.go

# è®¾ç½®å…¥å£
ENTRYPOINT ["license-gen"]
CMD ["-customer", "DefaultCustomer", "-output", "/output/license.key", "-privkey", "/app/private_key.pem"]
```

**ä½¿ç”¨**ï¼š
```bash
# æž„å»ºé•œåƒ
docker build -t license-generator .

# è¿è¡Œç”Ÿæˆè®¸å¯è¯
docker run -v $(pwd)/output:/output license-generator \
  -customer "Docker User" \
  -output /output/docker_license.key \
  -privkey /app/private_key.pem

# ç”Ÿæˆçš„è®¸å¯è¯åœ¨ ./output/docker_license.key
```

---

## ðŸ” å®‰å…¨æœ€ä½³å®žè·µ

### 1. ç§é’¥ä¿æŠ¤

```bash
# è®¾ç½®ä¸¥æ ¼æƒé™
chmod 600 private_key.pem
chown root:root private_key.pem  # ä»… root å¯è®¿é—®

# åŠ å¯†å­˜å‚¨
gpg -c private_key.pem  # ç”Ÿæˆ private_key.pem.gpg
rm private_key.pem      # åˆ é™¤æ˜Žæ–‡

# ä½¿ç”¨æ—¶è§£å¯†
gpg -d private_key.pem.gpg > /tmp/private_key.pem
go run license_gen.go -privkey /tmp/private_key.pem
shred -u /tmp/private_key.pem  # å®‰å…¨åˆ é™¤
```

### 2. å¯†é’¥å¤‡ä»½

```bash
# å¤šé‡å¤‡ä»½
mkdir -p /secure/backups/keys
cp new_private.pem /secure/backups/keys/backup_$(date +%Y%m%d).pem

# åŠ å¯†å¤‡ä»½åˆ°äº‘å­˜å‚¨
tar czf - new_private.pem | gpg -c > keys_backup.tar.gz.gpg
aws s3 cp keys_backup.tar.gz.gpg s3://secure-bucket/backups/
```

### 3. è®¿é—®æŽ§åˆ¶

```bash
# ä½¿ç”¨ä¸“é—¨çš„ç”¨æˆ·è´¦æˆ·
sudo useradd -r -s /bin/false license-manager
sudo chown license-manager:license-manager private_key.pem

# ä»…æŽˆæƒç”¨æˆ·å¯ä»¥ç”Ÿæˆè®¸å¯è¯
sudo -u license-manager go run license_gen.go -customer "User"
```

### 4. å®¡è®¡æ—¥å¿—

```bash
# è®°å½•æ¯æ¬¡è®¸å¯è¯ç”Ÿæˆ
cat >> /var/log/license-generation.log << EOF
$(date): Generated license for "$CUSTOMER_NAME" by $(whoami)
EOF
```

---

## âœ… éªŒè¯æ¸…å•

éƒ¨ç½²åˆ°æ–°æœºå™¨å‰ï¼Œè¯·æ£€æŸ¥ï¼š

- [ ] æºä»£ç å·²å®Œæ•´å¤åˆ¶ï¼ˆåŒ…æ‹¬ `internal/license/license.go`ï¼‰
- [ ] `internal/license/license.go` ä¸­çš„ `const _dba` æ˜¯æ­£ç¡®çš„å…¬é’¥
- [ ] ç§é’¥æ–‡ä»¶æ˜¯ `new_private.pem`ï¼ˆä¸Žæºä»£ç ä¸­çš„å…¬é’¥é…å¯¹ï¼‰
- [ ] Go ç‰ˆæœ¬ >= 1.21
- [ ] `go.mod` ä¸­æœ‰ `replace` æŒ‡ä»¤æŒ‡å‘æœ¬åœ°ä»£ç 
- [ ] è¿è¡Œ `go mod download` ä¸‹è½½ä¾èµ–
- [ ] æµ‹è¯•ç”Ÿæˆè®¸å¯è¯æˆåŠŸ
- [ ] æµ‹è¯•éªŒè¯è®¸å¯è¯æˆåŠŸ

**å®Œæ•´æµ‹è¯•å‘½ä»¤**ï¼š
```bash
cd /opt/license-deployment

# 1. æ£€æŸ¥æºä»£ç 
[ -f unioffice/internal/license/license.go ] && echo "âœ“ æºä»£ç å­˜åœ¨"

# 2. æ£€æŸ¥å¯†é’¥
[ -f private_key.pem ] && echo "âœ“ ç§é’¥å­˜åœ¨"

# 3. æ£€æŸ¥ Go
go version && echo "âœ“ Go å·²å®‰è£…"

# 4. ç”Ÿæˆæµ‹è¯•è®¸å¯è¯
go run license_gen.go \
  -customer "ValidationTest" \
  -output test.key \
  -privkey private_key.pem && echo "âœ“ è®¸å¯è¯ç”ŸæˆæˆåŠŸ"

# 5. éªŒè¯è®¸å¯è¯
cat > quick_verify.go << 'EOF'
package main
import ("fmt"; "os"; "github.com/unidoc/unioffice/v2/common/license")
func main() {
    data, _ := os.ReadFile("test.key")
    if err := license.SetLicenseKey(string(data), "ValidationTest"); err != nil {
        fmt.Printf("âŒ %v\n", err)
        os.Exit(1)
    }
    fmt.Println("âœ… éªŒè¯æˆåŠŸ!")
}
EOF

cat > go.mod << 'EOF'
module quick-verify
go 1.21
replace github.com/unidoc/unioffice/v2 => ./unioffice
require github.com/unidoc/unioffice/v2 v2.0.0
EOF

go run quick_verify.go && echo "âœ“ è®¸å¯è¯éªŒè¯æˆåŠŸ"

# å…¨éƒ¨é€šè¿‡
echo ""
echo "=============================="
echo "âœ… æ‰€æœ‰æµ‹è¯•é€šè¿‡ï¼å¯ä»¥å¼€å§‹ä½¿ç”¨"
echo "=============================="
```

---

## ðŸ“Š å¸¸è§é”™è¯¯å¯¹ç…§è¡¨

| é”™è¯¯ä¿¡æ¯ | åŽŸå›  | è§£å†³æ–¹æ¡ˆ |
|---------|------|---------|
| `crypto/rsa: verification error` | ç§é’¥ä¸Žæºä»£ç ä¸­çš„å…¬é’¥ä¸åŒ¹é… | ä½¿ç”¨ `new_private.pem` ç”Ÿæˆè®¸å¯è¯ |
| `customer name mismatch` | éªŒè¯æ—¶å®¢æˆ·åä¸ä¸€è‡´ | ç¡®ä¿å®¢æˆ·åå®Œå…¨åŒ¹é…ï¼ˆå¤§å°å†™æ•æ„Ÿï¼‰ |
| `no such file or directory` | æ–‡ä»¶è·¯å¾„é”™è¯¯ | æ£€æŸ¥æ–‡ä»¶æ˜¯å¦å­˜åœ¨ï¼Œä½¿ç”¨ç»å¯¹è·¯å¾„ |
| `permission denied` | æ–‡ä»¶æƒé™ä¸è¶³ | `chmod 644 license.key` |
| `package not found` | go.mod é…ç½®é”™è¯¯ | æ·»åŠ  `replace` æŒ‡ä»¤ |
| `cannot find module` | ä¾èµ–æœªä¸‹è½½ | `go mod download` |
| `invalid character` | è®¸å¯è¯æ–‡ä»¶æŸå | é‡æ–°ç”Ÿæˆè®¸å¯è¯ |

---

## ðŸ“ž å¿«é€Ÿå‚è€ƒ

### ç”Ÿæˆè®¸å¯è¯ï¼ˆæœ€ç®€å‘½ä»¤ï¼‰

```bash
go run license_gen.go -customer "å®¢æˆ·å" -privkey new_private.pem
```

### éªŒè¯è®¸å¯è¯ï¼ˆæœ€ç®€ä»£ç ï¼‰

```go
data, _ := os.ReadFile("license.key")
err := license.SetLicenseKey(string(data), "å®¢æˆ·å")
```

### ä¸€é”®æµ‹è¯•è„šæœ¬

```bash
#!/bin/bash
# test_all.sh

set -e

echo "1ï¸âƒ£ ç”Ÿæˆè®¸å¯è¯..."
go run license_gen.go -customer "TestUser" -output test.key -privkey new_private.pem

echo "2ï¸âƒ£ éªŒè¯è®¸å¯è¯..."
go run verify_license.go -license test.key -customer "TestUser"

echo "3ï¸âƒ£ åˆ›å»ºæµ‹è¯•æ–‡æ¡£..."
cat > test_doc.go << 'EOF'
package main
import ("github.com/unidoc/unioffice/v2/document"; "os"; "github.com/unidoc/unioffice/v2/common/license")
func main() {
    data, _ := os.ReadFile("test.key")
    license.SetLicenseKey(string(data), "TestUser")
    doc := document.New()
    doc.AddParagraph().AddRun().AddText("è®¸å¯è¯æµ‹è¯•")
    doc.SaveToFile("test_output.docx")
}
EOF

go run test_doc.go
echo "âœ… æ‰€æœ‰æµ‹è¯•é€šè¿‡ï¼ç”Ÿæˆäº† test_output.docx"
```

---

**æœ€åŽæ›´æ–°**: 2025-12-14  
**ç‰ˆæœ¬**: 2.0  
**çŠ¶æ€**: âœ… å·²éªŒè¯ï¼ˆåŒ…å«å¯†é’¥åŒ¹é…é—®é¢˜è§£å†³æ–¹æ¡ˆï¼‰
